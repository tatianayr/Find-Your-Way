<!doctype html>
<html lang="pt-br">

<head>
	<title> Projeto Web </title>
	<meta charset="utf-8">
	<meta name="author" content="Tatiana">
	<meta name="description" content="criação de uma web app">
	<meta name="keywords" content="html5, tecnologia">
	<link rel="stylesheet" href="stylesheets/form.css">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="javascripts/requests/questionario.js"></script>
	<script  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBkLXt8NqoaAz8doyQQHrqMwyJXwy-o-rk&callback=initMap"> </script>
	

</head>

<body>

	
	<nav>
		<!-- <img src="./imagens/logo.png" alt="logo" class="logo">-->
		 <ul>
			 <li><a href="index.html"> Home </a></li>
			 <li><a href="about.html"> About us </a> </li>
			 <li><a href="features.html"> Features </a> </li>
			 <li><a href="contacts.html"> Contacts </a> </li>
		 </ul>
		 <a href="perfil.html"><img src="./imagens/perfilicon.png" alt="perfilicon" class="perfil"></a>
	 </nav>


	<section>
		<form id="myForm">
			<div class="question" id="page1">
				<h1>Question 1</h1>
				<h2>At what season would you like to make your trip?</h2>
				<div id="q1">
					<input type="radio" name="season" value="1">Spring<br>
					<input type="radio" name="season" value="2">Summer<br>
					<input type="radio" name="season" value="3">Autumn<br>
					<input type="radio" name="season" value="4">Winter<br><br>
				</div>
				<input type="button" value="Next" onclick="nextPage()" id="nextButton">

			</div>


			<div class="question" id="page2">
				<h1>Question 2</h1>
				<h2>which historic architecture draws more attention?</h2>
				<div id="q2">
				</div>
				<input type="button" value="Previous" onclick="prevPage()" id="prevButton">
				<input type="button" value="Next" onclick="nextPage()" id="nextButton">

			</div>
			<div class="question" id="page3">
				<h1>Question 3</h1>
				<h2>Which of these interests would you like to experience on your trip?</h2>
				<div id="q3">
				</div>
				<input type="button" value="Previous" onclick="prevPage()" id="prevButton">
				<input type="button" value="Next" onclick="nextPage()" id="nextButton">
			</div>

			<div class="question" id="page4">
				<h1>Question 4</h1>
				<h2>Would you rather visit a city:</h2>
				<div id="q4"></div>
				<div id="cityList"></div>
				
				<input type="button" value="Previous" onclick="prevPage()" id="prevButton">
				<input type="submit" value="Submit" id="subButton" onclick="showCities(); return false;">
			  </div>

			  <div id="mapContainer">
				<div id="map" style="height: 20em;"></div>
			  </div>
			  


		</form>
	</section>


	<script>
		document.getElementById("myForm").addEventListener("submit", function (event) {
			// perform some JavaScript logic here
			event.preventDefault(); // prevent the form from submitting
			console.log(season, histories, activity,cost);
		});

		var currentQuestion = 1;
		var questionPages = document.querySelectorAll(".question");
		var season = 1;
		var histories = 1;
		var activity =1;
		var cost=1;
		var number=1;

		

		async function nextPage() {
			if (currentQuestion == 1) {
				let questions = document.getElementById("q1");
				//Este trecho de código percorre cada nó filho do elemento questions. Presume-se que esses nós sejam os elementos de opção da pergunta 
				//atual. O loop verifica se algum elemento está marcado como selecionado (ou seja, a opção foi escolhida) e, se for o caso, armazena o
				// valor da opção na variável season.
				questions.childNodes.forEach(element => {
					if (element.checked) season = element.value;
				});
				await question2();
			}
			
			else if (currentQuestion == 2) {
				let questions = document.getElementById("q2");
				questions.childNodes.forEach(element => {
					if (element.checked) histories = element.value;
				});
				await question3();
			}
			else if (currentQuestion == 3) {
				let questions = document.getElementById("q3");
				questions.childNodes.forEach(element => {
					if (element.checked) activity = element.value;
				});
				await question4();
			}
			else if (currentQuestion == 4) {
				let questions = document.getElementById("q4");
				questions.childNodes.forEach(element => {
					if (element.checked) cost = element.value;
				});
				await question5();
			}
			if (currentQuestion < questionPages.length) {
				questionPages[currentQuestion - 1].style.display = "none";
				currentQuestion++;
				questionPages[currentQuestion - 1].style.display = "block";
			}
		}
		

		function prevPage() {
			if (currentQuestion > 1) {
				questionPages[currentQuestion - 1].style.display = "none";
				currentQuestion--;
				questionPages[currentQuestion - 1].style.display = "block";
			}
		}
	</script>

<script>
	// Function to check if the user is logged in
	async function checkLoginStatus() {
		try {
			const response = await fetch('/api/users/auth');
			if (response.status === 200) {
				// User is logged in, continue with the questionnaire
				return;
			} else {
				// User is not logged in, redirect to the login page
				window.location.href = 'login.html';
			}
		} catch (err) {
			console.log(err);
			// Handle error
		}
	}

	// Wait for the DOM to load
	document.addEventListener('DOMContentLoaded', function () {
		// Check login status before proceeding
		checkLoginStatus();
	});

	// Rest of your JavaScript code
</script>
</body>

</html>